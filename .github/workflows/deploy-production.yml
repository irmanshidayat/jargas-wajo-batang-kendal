name: Deploy Production

on:
  push:
    branches:
      - main
  workflow_dispatch: # Manual trigger

env:
  SERVER_IP: 72.61.142.109
  SERVER_USER: root
  PROJECT_PATH: ~/jargas-wajo-batang-kendal
  GITHUB_REPO: https://github.com/irmanshidayat/jargas-wajo-batang-kendal.git
  GITHUB_REPO: https://github.com/irmanshidayat/jargas-wajo-batang-kendal.git

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Add server to known hosts
        run: |
          ssh-keyscan -H ${{ env.SERVER_IP }} >> ~/.ssh/known_hosts

      - name: Test SSH Connection
        run: |
          echo "üîç Testing SSH connection..."
          ssh -o ConnectTimeout=10 -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} 'echo "‚úÖ SSH connection successful!"' || {
            echo "‚ùå SSH connection failed!"
            echo "Please verify:"
            echo "1. Public key is added to server ~/.ssh/authorized_keys"
            echo "2. SSH_PRIVATE_KEY secret is correctly configured in GitHub"
            echo "3. Server is accessible: ${{ env.SERVER_IP }}"
            exit 1
          }

      - name: Test SSH Connection
        run: |
          echo "üîç Testing SSH connection..."
          ssh -o ConnectTimeout=10 -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} 'echo "‚úÖ SSH connection successful!"' || {
            echo "‚ùå SSH connection failed!"
            echo "Please verify:"
            echo "1. Public key is added to server ~/.ssh/authorized_keys"
            echo "2. SSH_PRIVATE_KEY secret is correctly configured in GitHub"
            echo "3. Server is accessible: ${{ env.SERVER_IP }}"
            exit 1
          }

      - name: Deploy to Production Server
        run: |
          ssh -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} bash -s << 'DEPLOY_SCRIPT'
          ssh -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} bash -s << 'DEPLOY_SCRIPT'
            set -e
            
            # Expand ~ to full path
            PROJECT_PATH="${{ env.PROJECT_PATH }}"
            PROJECT_PATH=$(eval echo "$PROJECT_PATH")
            GITHUB_REPO="${{ env.GITHUB_REPO }}"
            
            echo "=========================================="
            echo "üöÄ Starting Deployment Process"
            echo "=========================================="
            echo "Project Path: $PROJECT_PATH"
            echo "GitHub Repo: $GITHUB_REPO"
            echo ""
            
            # Step 1: Verify project path exists
            echo "Step 1: Verifying project path..."
            if [ ! -d "$PROJECT_PATH" ]; then
              echo "‚ö†Ô∏è  Project path does not exist: $PROJECT_PATH"
              echo "Creating directory..."
              mkdir -p "$PROJECT_PATH" || {
                echo "‚ùå Error: Cannot create directory $PROJECT_PATH"
                exit 1
              }
              echo "‚úÖ Directory created"
            else
              echo "‚úÖ Project path exists"
            fi
            
            # Step 2: Navigate to project directory
            echo ""
            echo "Step 2: Navigating to project directory..."
            cd "$PROJECT_PATH" || {
              echo "‚ùå Error: Cannot cd to $PROJECT_PATH"
              exit 1
            }
            echo "‚úÖ Current directory: $(pwd)"
            
            # Step 3: Check if Git repository exists, if not clone it
            echo ""
            echo "Step 3: Checking Git repository..."
            if [ ! -d ".git" ]; then
              echo "‚ö†Ô∏è  Git repository not found in $PROJECT_PATH"
              echo "Checking if directory is empty..."
              FILE_COUNT=$(find . -maxdepth 1 -not -name '.' -not -name '..' 2>/dev/null | wc -l)
              if [ "$FILE_COUNT" -gt 0 ]; then
                echo "‚ö†Ô∏è  Directory is not empty ($FILE_COUNT items found)"
                echo "Files in directory:"
                ls -la | head -10
                echo ""
                echo "Initializing git repository in existing directory..."
                git init || {
                  echo "‚ùå Error: Cannot initialize git repository"
                  exit 1
                }
                # Check if remote already exists
                if ! git remote get-url origin >/dev/null 2>&1; then
                  git remote add origin "$GITHUB_REPO" || {
                    echo "‚ùå Error: Cannot add remote origin"
                    exit 1
                  }
                else
                  echo "‚ö†Ô∏è  Remote origin already exists, updating URL..."
                  git remote set-url origin "$GITHUB_REPO" || {
                    echo "‚ö†Ô∏è  Warning: Cannot update remote URL"
                  }
                fi
                echo "‚úÖ Git repository initialized"
              else
                echo "Directory is empty, cloning repository..."
                git clone -b main "$GITHUB_REPO" . || {
                  echo "‚ùå Error: Cannot clone repository"
                  exit 1
                }
                echo "‚úÖ Repository cloned successfully"
              fi
            else
              echo "‚úÖ Git repository found"
            fi
            
            # Step 4: Pull latest code
            echo ""
            echo "Step 4: Pulling latest code from main branch..."
            # Fetch latest changes
            if ! git fetch origin 2>&1; then
              echo "‚ö†Ô∏è  Warning: git fetch failed, checking remote..."
              if ! git remote get-url origin >/dev/null 2>&1; then
                echo "‚ö†Ô∏è  No remote origin found, adding remote..."
                git remote add origin "$GITHUB_REPO" || {
                  echo "‚ùå Error: Cannot add remote origin"
                  exit 1
                }
                git fetch origin || {
                  echo "‚ùå Error: Cannot fetch from remote"
                  exit 1
                }
              fi
            fi
            
            # Checkout main branch
            if ! git checkout main 2>&1; then
              echo "‚ö†Ô∏è  Cannot checkout main branch, trying to create it from origin/main..."
              git checkout -b main origin/main 2>&1 || {
                echo "‚ùå Error: Cannot checkout or create main branch"
                echo "Current branch: $(git branch --show-current 2>/dev/null || echo 'unknown')"
                echo "Available branches:"
                git branch -a || true
                exit 1
              }
            fi
            
            # Reset to origin/main
            if ! git reset --hard origin/main 2>&1; then
              echo "‚ùå Error: Cannot reset to origin/main"
              echo "Please check if main branch exists in remote"
              echo "Current branch: $(git branch --show-current 2>/dev/null || echo 'unknown')"
              echo "Remote branches:"
              git branch -r || true
              exit 1
            fi
            echo "‚úÖ Code updated to latest main branch"
            echo "   Commit: $(git rev-parse --short HEAD 2>/dev/null || echo 'unknown')"
            
            # Step 5: Verify and create environment files if needed
            echo ""
            echo "Step 5: Verifying environment files..."
            
            # Check and create .env from template
            if [ ! -f .env ]; then
              echo "‚ö†Ô∏è  .env not found in project root"
              if [ -f env.example ]; then
                echo "Creating .env from env.example template..."
                cp env.example .env || {
                  echo "‚ùå Error: Cannot create .env from template"
                  exit 1
                }
                echo "‚úÖ .env created from template"
                echo "‚ö†Ô∏è  WARNING: Please review and update .env with correct values!"
                echo "   Especially SECRET_KEY, DB_PASSWORD, and other sensitive values"
              else
                echo "‚ùå Error: .env not found and env.example template also not found"
                echo "Current directory: $(pwd)"
                echo "Files in current directory:"
                ls -la | head -10
                exit 1
              fi
            else
              echo "‚úÖ .env found"
            fi
            
            # Check and create backend/.env from template
            if [ ! -f backend/.env ]; then
              echo "‚ö†Ô∏è  backend/.env not found"
              if [ -f backend/env.example ]; then
                echo "Creating backend/.env from backend/env.example template..."
                cp backend/env.example backend/.env || {
                  echo "‚ùå Error: Cannot create backend/.env from template"
                  exit 1
                }
                echo "‚úÖ backend/.env created from template"
                echo "‚ö†Ô∏è  WARNING: Please review and update backend/.env with correct values!"
              elif [ -f env.example ]; then
                echo "Creating backend/.env from root env.example template..."
                cp env.example backend/.env || {
                  echo "‚ùå Error: Cannot create backend/.env from template"
                  exit 1
                }
                echo "‚úÖ backend/.env created from root template"
                echo "‚ö†Ô∏è  WARNING: Please review and update backend/.env with correct values!"
              else
                echo "‚ùå Error: backend/.env not found and no template available"
                echo "Files in backend directory:"
                ls -la backend/ | head -10 || echo "backend/ directory does not exist"
                exit 1
              fi
            else
              echo "‚úÖ backend/.env found"
            fi
            
            echo "‚úÖ Environment files verified/created"
            
            # Step 6: Verify docker-compose file exists
            echo ""
            echo "Step 6: Verifying docker-compose.yml..."
            if [ ! -f docker-compose.yml ]; then
              echo "‚ùå Error: docker-compose.yml not found"
              exit 1
            fi
            echo "‚úÖ docker-compose.yml found"
            
            # Step 7: Build Docker containers
            echo ""
            echo "Step 7: Building Docker containers (production)..."
            if ! docker-compose --env-file .env build --no-cache 2>&1; then
              echo "‚ùå Error: Docker build failed"
              echo "Checking Docker status..."
              docker ps -a || echo "Docker not accessible"
              exit 1
            fi
            echo "‚úÖ Docker build completed"
            
            # Step 8: Stop existing containers
            echo ""
            echo "Step 8: Stopping existing containers..."
            docker-compose --env-file .env down 2>&1 || {
              echo "‚ö†Ô∏è  Warning: Some containers may not have stopped cleanly"
            }
            echo "‚úÖ Containers stopped"
            
            # Step 9: Start containers
            echo ""
            echo "Step 9: Starting containers..."
            if ! docker-compose --env-file .env up -d 2>&1; then
              echo "‚ùå Error: Failed to start containers"
              echo "Checking container status..."
              docker-compose --env-file .env ps || true
              echo "Checking logs..."
              docker-compose --env-file .env logs --tail=50 || true
              exit 1
            fi
            echo "‚úÖ Containers started"
            
            # Step 10: Wait for services
            echo ""
            echo "Step 10: Waiting for services to be ready..."
            
            # Expand ~ to full path
            PROJECT_PATH="${{ env.PROJECT_PATH }}"
            PROJECT_PATH=$(eval echo "$PROJECT_PATH")
            GITHUB_REPO="${{ env.GITHUB_REPO }}"
            
            echo "=========================================="
            echo "üöÄ Starting Deployment Process"
            echo "=========================================="
            echo "Project Path: $PROJECT_PATH"
            echo "GitHub Repo: $GITHUB_REPO"
            echo ""
            
            # Step 1: Verify project path exists
            echo "Step 1: Verifying project path..."
            if [ ! -d "$PROJECT_PATH" ]; then
              echo "‚ö†Ô∏è  Project path does not exist: $PROJECT_PATH"
              echo "Creating directory..."
              mkdir -p "$PROJECT_PATH" || {
                echo "‚ùå Error: Cannot create directory $PROJECT_PATH"
                exit 1
              }
              echo "‚úÖ Directory created"
            else
              echo "‚úÖ Project path exists"
            fi
            
            # Step 2: Navigate to project directory
            echo ""
            echo "Step 2: Navigating to project directory..."
            cd "$PROJECT_PATH" || {
              echo "‚ùå Error: Cannot cd to $PROJECT_PATH"
              exit 1
            }
            echo "‚úÖ Current directory: $(pwd)"
            
            # Step 3: Check if Git repository exists, if not clone it
            echo ""
            echo "Step 3: Checking Git repository..."
            if [ ! -d ".git" ]; then
              echo "‚ö†Ô∏è  Git repository not found in $PROJECT_PATH"
              echo "Checking if directory is empty..."
              FILE_COUNT=$(find . -maxdepth 1 -not -name '.' -not -name '..' 2>/dev/null | wc -l)
              if [ "$FILE_COUNT" -gt 0 ]; then
                echo "‚ö†Ô∏è  Directory is not empty ($FILE_COUNT items found)"
                echo "Files in directory:"
                ls -la | head -10
                echo ""
                echo "Initializing git repository in existing directory..."
                git init || {
                  echo "‚ùå Error: Cannot initialize git repository"
                  exit 1
                }
                # Check if remote already exists
                if ! git remote get-url origin >/dev/null 2>&1; then
                  git remote add origin "$GITHUB_REPO" || {
                    echo "‚ùå Error: Cannot add remote origin"
                    exit 1
                  }
                else
                  echo "‚ö†Ô∏è  Remote origin already exists, updating URL..."
                  git remote set-url origin "$GITHUB_REPO" || {
                    echo "‚ö†Ô∏è  Warning: Cannot update remote URL"
                  }
                fi
                echo "‚úÖ Git repository initialized"
              else
                echo "Directory is empty, cloning repository..."
                git clone -b main "$GITHUB_REPO" . || {
                  echo "‚ùå Error: Cannot clone repository"
                  exit 1
                }
                echo "‚úÖ Repository cloned successfully"
              fi
            else
              echo "‚úÖ Git repository found"
            fi
            
            # Step 4: Pull latest code
            echo ""
            echo "Step 4: Pulling latest code from main branch..."
            # Fetch latest changes
            if ! git fetch origin 2>&1; then
              echo "‚ö†Ô∏è  Warning: git fetch failed, checking remote..."
              if ! git remote get-url origin >/dev/null 2>&1; then
                echo "‚ö†Ô∏è  No remote origin found, adding remote..."
                git remote add origin "$GITHUB_REPO" || {
                  echo "‚ùå Error: Cannot add remote origin"
                  exit 1
                }
                git fetch origin || {
                  echo "‚ùå Error: Cannot fetch from remote"
                  exit 1
                }
              fi
            fi
            
            # Checkout main branch
            if ! git checkout main 2>&1; then
              echo "‚ö†Ô∏è  Cannot checkout main branch, trying to create it from origin/main..."
              git checkout -b main origin/main 2>&1 || {
                echo "‚ùå Error: Cannot checkout or create main branch"
                echo "Current branch: $(git branch --show-current 2>/dev/null || echo 'unknown')"
                echo "Available branches:"
                git branch -a || true
                exit 1
              }
            fi
            
            # Reset to origin/main
            if ! git reset --hard origin/main 2>&1; then
              echo "‚ùå Error: Cannot reset to origin/main"
              echo "Please check if main branch exists in remote"
              echo "Current branch: $(git branch --show-current 2>/dev/null || echo 'unknown')"
              echo "Remote branches:"
              git branch -r || true
              exit 1
            fi
            echo "‚úÖ Code updated to latest main branch"
            echo "   Commit: $(git rev-parse --short HEAD 2>/dev/null || echo 'unknown')"
            
            # Step 5: Verify and create environment files if needed
            echo ""
            echo "Step 5: Verifying environment files..."
            
            # Check and create .env from template
            if [ ! -f .env ]; then
              echo "‚ö†Ô∏è  .env not found in project root"
              if [ -f env.example ]; then
                echo "Creating .env from env.example template..."
                cp env.example .env || {
                  echo "‚ùå Error: Cannot create .env from template"
                  exit 1
                }
                echo "‚úÖ .env created from template"
                echo "‚ö†Ô∏è  WARNING: Please review and update .env with correct values!"
                echo "   Especially SECRET_KEY, DB_PASSWORD, and other sensitive values"
              else
                echo "‚ùå Error: .env not found and env.example template also not found"
                echo "Current directory: $(pwd)"
                echo "Files in current directory:"
                ls -la | head -10
                exit 1
              fi
            else
              echo "‚úÖ .env found"
            fi
            
            # Check and create backend/.env from template
            if [ ! -f backend/.env ]; then
              echo "‚ö†Ô∏è  backend/.env not found"
              if [ -f backend/env.example ]; then
                echo "Creating backend/.env from backend/env.example template..."
                cp backend/env.example backend/.env || {
                  echo "‚ùå Error: Cannot create backend/.env from template"
                  exit 1
                }
                echo "‚úÖ backend/.env created from template"
                echo "‚ö†Ô∏è  WARNING: Please review and update backend/.env with correct values!"
              elif [ -f env.example ]; then
                echo "Creating backend/.env from root env.example template..."
                cp env.example backend/.env || {
                  echo "‚ùå Error: Cannot create backend/.env from template"
                  exit 1
                }
                echo "‚úÖ backend/.env created from root template"
                echo "‚ö†Ô∏è  WARNING: Please review and update backend/.env with correct values!"
              else
                echo "‚ùå Error: backend/.env not found and no template available"
                echo "Files in backend directory:"
                ls -la backend/ | head -10 || echo "backend/ directory does not exist"
                exit 1
              fi
            else
              echo "‚úÖ backend/.env found"
            fi
            
            echo "‚úÖ Environment files verified/created"
            
            # Step 6: Verify docker-compose file exists
            echo ""
            echo "Step 6: Verifying docker-compose.yml..."
            if [ ! -f docker-compose.yml ]; then
              echo "‚ùå Error: docker-compose.yml not found"
              exit 1
            fi
            echo "‚úÖ docker-compose.yml found"
            
            # Step 7: Build Docker containers
            echo ""
            echo "Step 7: Building Docker containers (production)..."
            if ! docker-compose --env-file .env build --no-cache 2>&1; then
              echo "‚ùå Error: Docker build failed"
              echo "Checking Docker status..."
              docker ps -a || echo "Docker not accessible"
              exit 1
            fi
            echo "‚úÖ Docker build completed"
            
            # Step 8: Stop existing containers
            echo ""
            echo "Step 8: Stopping existing containers..."
            docker-compose --env-file .env down 2>&1 || {
              echo "‚ö†Ô∏è  Warning: Some containers may not have stopped cleanly"
            }
            echo "‚úÖ Containers stopped"
            
            # Step 9: Start containers
            echo ""
            echo "Step 9: Starting containers..."
            if ! docker-compose --env-file .env up -d 2>&1; then
              echo "‚ùå Error: Failed to start containers"
              echo "Checking container status..."
              docker-compose --env-file .env ps || true
              echo "Checking logs..."
              docker-compose --env-file .env logs --tail=50 || true
              exit 1
            fi
            echo "‚úÖ Containers started"
            
            # Step 10: Wait for services
            echo ""
            echo "Step 10: Waiting for services to be ready..."
            sleep 30
            
            # Step 11: Check container status
            echo ""
            echo "Step 11: Checking container status..."
            docker-compose --env-file .env ps
            
            # Check if containers are running
            RUNNING_CONTAINERS=$(docker-compose --env-file .env ps -q | wc -l)
            if [ "$RUNNING_CONTAINERS" -eq 0 ]; then
              echo "‚ö†Ô∏è  Warning: No containers are running"
              echo "Checking logs for errors..."
              docker-compose --env-file .env logs --tail=100 || true
            else
              echo "‚úÖ $RUNNING_CONTAINERS container(s) running"
            fi
            
            # Step 12: Setup/Verify Nginx Config
            echo ""
            echo "Step 12: Setting up Nginx configuration..."
            if [ -f "nginx-host/jargas.conf" ]; then
              echo "‚úÖ Nginx config file found"
              # Copy nginx config
              sudo cp nginx-host/jargas.conf /etc/nginx/sites-available/jargas 2>&1 || {
                echo "‚ö†Ô∏è  Warning: Cannot copy nginx config (may need sudo)"
              }
              
              # Create symlink if not exists
              if [ ! -L "/etc/nginx/sites-enabled/jargas" ]; then
                echo "Creating nginx symlink..."
                sudo ln -s /etc/nginx/sites-available/jargas /etc/nginx/sites-enabled/jargas 2>&1 || {
                  echo "‚ö†Ô∏è  Warning: Cannot create symlink (may need sudo)"
                }
              fi
              
              # Test nginx config
              if sudo nginx -t 2>&1; then
                echo "‚úÖ Nginx config is valid"
                # Reload nginx
                sudo systemctl reload nginx 2>&1 || {
                  echo "‚ö†Ô∏è  Warning: Cannot reload nginx (may need sudo or nginx not installed)"
                }
                echo "‚úÖ Nginx reloaded"
              else
                echo "‚ö†Ô∏è  Warning: Nginx config test failed"
              fi
            else
              echo "‚ö†Ô∏è  Warning: nginx-host/jargas.conf not found"
              echo "   Nginx config will not be updated"
            fi
            
            echo ""
            echo "=========================================="
            echo "‚úÖ Deployment completed!"
            echo "=========================================="
            echo "=========================================="
            echo "üåê Frontend: https://jargas.ptkiansantang.com"
            echo "üîó Backend: https://jargas.ptkiansantang.com/health"
            echo ""
          DEPLOY_SCRIPT
            echo "üîó Backend: https://jargas.ptkiansantang.com/health"
            echo ""
          DEPLOY_SCRIPT

      - name: Health Check
        run: |
          echo "üîç Waiting for services to be fully ready..."
          sleep 20
          echo "üè• Testing health endpoints..."
          
          # Try multiple endpoints with fallback
          HEALTH_CHECK_PASSED=false
          
          # 1. Try HTTP /health (nginx static endpoint)
          echo "Testing: http://jargas.ptkiansantang.com/health"
          if curl -f -s --max-time 10 http://jargas.ptkiansantang.com/health > /dev/null 2>&1; then
            echo "‚úÖ Health check passed: http://jargas.ptkiansantang.com/health"
            HEALTH_CHECK_PASSED=true
          fi
          
          # 2. Try HTTPS /health (nginx static endpoint)
          if [ "$HEALTH_CHECK_PASSED" = false ]; then
            echo "Testing: https://jargas.ptkiansantang.com/health"
            if curl -f -s --max-time 10 -k https://jargas.ptkiansantang.com/health > /dev/null 2>&1; then
              echo "‚úÖ Health check passed: https://jargas.ptkiansantang.com/health"
              HEALTH_CHECK_PASSED=true
            fi
          fi
          
          # 3. Try backend container directly (via SSH)
          if [ "$HEALTH_CHECK_PASSED" = false ]; then
            echo "Testing: Backend container directly (localhost:8001/health)"
            PROJECT_PATH="${{ env.PROJECT_PATH }}"
            if ssh -o ConnectTimeout=5 -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} "curl -f -s --max-time 10 http://localhost:8001/health > /dev/null 2>&1" 2>/dev/null; then
              echo "‚úÖ Health check passed: Backend container (localhost:8001/health)"
              HEALTH_CHECK_PASSED=true
            fi
          fi
          
          # 4. Try HTTP /api/health (if backend has it)
          if [ "$HEALTH_CHECK_PASSED" = false ]; then
            echo "Testing: http://jargas.ptkiansantang.com/api/health"
            if curl -f -s --max-time 10 http://jargas.ptkiansantang.com/api/health > /dev/null 2>&1; then
              echo "‚úÖ Health check passed: http://jargas.ptkiansantang.com/api/health"
              HEALTH_CHECK_PASSED=true
            fi
          fi
          
          if [ "$HEALTH_CHECK_PASSED" = false ]; then
            echo "‚ùå Health check failed for all endpoints"
            echo ""
            echo "Debugging information:"
            echo "1. Testing HTTP /health:"
            curl -v --max-time 10 http://jargas.ptkiansantang.com/health 2>&1 | head -20 || true
            echo ""
            echo "2. Testing HTTPS /health:"
            curl -v --max-time 10 -k https://jargas.ptkiansantang.com/health 2>&1 | head -20 || true
            echo ""
            echo "3. Testing backend container directly:"
            ssh -o ConnectTimeout=5 -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} "curl -v --max-time 10 http://localhost:8001/health 2>&1 | head -20" || true
            echo ""
            echo "4. Checking container status:"
            PROJECT_PATH="${{ env.PROJECT_PATH }}"
            ssh -o ConnectTimeout=5 -o StrictHostKeyChecking=no ${{ env.SERVER_USER }}@${{ env.SERVER_IP }} "cd $PROJECT_PATH && docker-compose --env-file .env ps" || true
            exit 1
          fi
          
          echo ""
          echo "‚úÖ Health check successful!"

      - name: Deployment Summary
        run: |
          echo "## ‚úÖ Production Deployment Successful" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Frontend**: https://jargas.ptkiansantang.com" >> $GITHUB_STEP_SUMMARY
          echo "- **Backend**: https://jargas.ptkiansantang.com/health" >> $GITHUB_STEP_SUMMARY
          echo "- **Backend**: https://jargas.ptkiansantang.com/health" >> $GITHUB_STEP_SUMMARY
          echo "- **Deployed at**: $(date)" >> $GITHUB_STEP_SUMMARY

